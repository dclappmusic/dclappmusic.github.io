<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="dClapp">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>dClapp</title>
	<link rel="icon" type="image/jpg" href="images/favicon.png">
	<link rel="stylesheet" href="css/styles.css">
	<meta name="p:domain_verify" content="010c67b82d18bca303e35e8b40011654"/>
</head>

<body>
	<div class="container home">
		<div class="icon-esquina options">
			<svg width="8" height="34" viewBox="0 0 8 34" fill="none" xmlns="http://www.w3.org/2000/svg">
				<circle cx="4" cy="4" r="4" fill="#0C3847"/>
				<circle cx="4" cy="17" r="4" fill="#0C3847"/>
				<circle cx="4" cy="30" r="4" fill="#0C3847"/>
			</svg>
			<a class="boton-sm options_login" href="login.html">login</a>
		</div>
		<ul class="cambio_modo"></ul>
		<a class="boton showtime" href="clapp.html">
			<img src="images/icon_clapp.png" />
		</a>
		<div class="intro_clapp">
			<a href="sign_band.html"><h3 class="display-med">applaud<br>the talent</h3></a>
		</div>

		<ul class="menu">
			<li class="menu-tit historial">
				<a href="historial.html">history</a>
			</li>
			<li class="menu-tit active" id="preclapp">
				<a href="index.html">CLAPP</a>
			</li>
			<li class="menu-tit">
				<a href="bandas.html">bands</a>
			</li>
		</ul>
	</div>

	
<!-- codigo externo -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.1/firebase.js"></script>

<!-- codigo propio -->
<script type="text/javascript" src="js/firebase-config.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript">
// 1.script.js -> chekear si hay user loggeado
// 2.chekear parametros en la URL
// 3.si no esta loggeado, cambiar link del menu historial, a login
// 4.si hay usuario, poner enlace a sus bandas
// event - toggle de opciones

//esta funcion se ejecuta siempre despues de checkear si esta loggeado
	function funcion_user () {
		var user;

		//2.si viene desde login, ponerle un CTA para crear banda
		var from = getUrlParameter("from");
		console.log(from);
		if (from === "login") {
			console.log("viene de login");
			$(".intro_clapp h3").html("Crea un perfil para tu <b>banda</b>");
			$(".intro_clapp a").attr("href", "sign_band.html");
		}

		//event - desplegable del botón de menú, por ahora sólo con login
		$(".options").click(function(){
			$(".options_login").toggleClass("active");
		});

		//3.si no está logeado, el link a historial te lleva a login
		if (!login) {
			$(".menu .historial a").attr("href", "login.html");
		} else {
			$(".options_login").html("logout");
		}
		
		
		//3.cargar el usuario de la DB
		const userRef = firestore.collection("usuarios").doc(userId);
		userRef.get().then((doc) => {
			//si está loggeado carga y tiene bandas, las carga
			if (doc.exists) {
				console.log("Document data:", doc.data());
				user = doc.data();
				console.log("bandas del user: ");
				console.log(user.band);

				//si tiene bandas, añadir al menu
				if (user.band.length > 0) {
					console.log(user.band);
					user.band.forEach((banda) => {
						const db_banda = banda.band_name;
						console.log(db_banda);
						const liBandas = "<li><a href='showtime.html?band=" + banda.band_id + "'>" + db_banda + "</a></li>"
						$(".cambio_modo").append(liBandas);
					});
				} else {
					console.log("no bands");
					$(".cambio_modo").hide();
				}
			} else {
				console.log("No user");
			}
		}).catch(function(error) {
			console.log("Error getting document:", error);
		});
	}
</script>
</body>
</html>








