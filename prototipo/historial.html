<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="dClapp">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>dClapp</title>
	<link rel="icon" type="image/jpg" href="images/favicon.png">
	<link rel="stylesheet" href="css/styles.css">
	<meta name="p:domain_verify" content="010c67b82d18bca303e35e8b40011654"/>

</head>

<body>
	<div class="container historial">
        <h1 class="cabecera">HISTORIAL</h1>
        <ul class="clapps">
            <!-- <li class="clappeado">
                <p class="band">Prueba</p>
                <p class="clapps_dados">10</p>
            </li> -->
        </ul>
        <ul class="menu">
			<li class="menu-tit active">
				<a href="historial.html">historial</a>
			</li>
			<li class="menu-tit" id="preclapp">
				<a href="index.html">CLAPP</a>
			</li>
			<li class="menu-tit">
				<a href="opciones.html">opciones</a>
			</li>
		</ul>
	</div>

	

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.1/firebase.js"></script>
<script type="text/javascript" src="js/firebase-config.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript">
	function funcion_user () {
	// --------------historial de clapps
		var user; 

		//cargar historial de clapps dado el identificador del perfil del usuario
		function cargar_historial (I_id) {
			console.log("cargar historial");

			//descargarse user_persona 
			const userRef = firestore.collection("usuarios").doc(userId);
			const bandsRef = firestore.collection("bandas");
			userRef.get().then((doc) => {
				// console.log("Document data:", doc.data());
				user = doc.data();
				//Por cada clapp, mostrar sus datos añadiendolos a una lista
				if (user.clapps.length > 0) {
					console.log("num total de clapps: " + user.clapps.length);
					user.clapps.forEach((I_banda) => {
						const bandRef = bandsRef.doc(I_banda);
						bandRef.get().then((doc) => {
							const db_banda = doc.data();
							const liBandas = "<li class='clappeado'><a href='perfil.html?band=" + doc.id + "'><img src='images/perfil_kurt.png' /><p class='band'>" + db_banda.nombre + "</p></a></li>"
							$(".clapps").append(liBandas);
						});
					});
				} else {
					console.log("no bands");
					$(".cambio_modo").hide();
				}
			});

			//Por cada clapp, mostrar sus datos añadiendolos a una lista
			
			// usuario.historial_clapps.forEach(function(I_userClapps) {
			// 	console.log(I_userClapps.clappeado);
			// 	var banda = bandas.find(o => o.name === I_userClapps.clappeado);
			// 	console.log(banda);
			// 	$(".clapps").append(
			// 		'<li class="clappeado"><img src="' + banda.imagen + '"><p class="band">' + banda.name + '</p><p class="clapps_dados">' + I_userClapps.num_clapps + '</p></li>'
			// 	);
			// });
		};
		if (login) {
			cargar_historial(userId);
		} else {
			window.location.href = "login.html";
		}
		
	}
</script>	
</body>
</html>








